# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build

```

# Описание базового кода: интерфейсы и классы

### Интерфейс IAppState - описывает данные компонентов приложения: каталога товаров, корзины, превью карточки и заказа

```
interface IAppState {
    catalog: ILotItem[];
    basket: string[];
    preview: string | null;
    order: IOrder | null;
}
```

### Интерфейс ILotItem - описывает данные данные товара

```
interface ILotItem {
    id?: string;
    title: string;
    description?: string;
    image?: string;
    price: number;
    category?: string;
}
```

### Интерфейс IOrderForm - описывает информацию от пользователя, требуемую при оформлении заказа

```
interface IOrderForm {
    email: string;
    phone: string;
    address: string;
    payment: string;
}
```

### Интерфейс IOrder - описывает информацию о заказе: список товаров и общую сумму, и также включает в себя интерфейс IOrderForm

```
interface IOrder extends IOrderForm {
    items: string[];
    total: number;
}
```

### Интерфейс IOrderResult - содержит id оформленного заказа

```
interface IOrderResult {
    id: string;
}
```

## 1. Абстрактный класс Component<T> 
Представляет собой базовый компонент для работы с DOM элементами. Он предоставляет инструменты для управления отображением и поведением элементов на веб-странице.

#### Конструктор
- **protected constructor(container: HTMLElement)**:
  - Создает экземпляр класса Component с указанным контейнером (DOM элемент), к которому будет привязан компонент.

#### Методы
1. **toggleClass(element: HTMLElement, className: string, force?: boolean)**:
   - Переключает класс у указанного DOM элемента.
   
2. **setText(element: HTMLElement, value: unknown)**:
   - Устанавливает текстовое содержимое для указанного DOM элемента.
   
3. **setDisabled(element: HTMLElement, state: boolean)**:
   - Устанавливает состояние блокировки для указанного DOM элемента.
   
4. **setHidden(element: HTMLElement)**:
   - Скрывает указанный DOM элемент.
   
5. **setVisible(element: HTMLElement)**:
   - Показывает указанный DOM элемент.
   
6. **setImage(element: HTMLImageElement, src: string, alt?: string)**:
   - Устанавливает изображение с альтернативным текстом для указанного элемента <img>.
   
7. **render(data?: Partial<T>): HTMLElement**:
   - Отображает компонент с возможностью передачи данных для отрисовки.

  
## 2.Класс EventEmitter
Представляет собой инструмент для управления событиями и обработчиками событий в приложении. Он позволяет устанавливать обработчики на определенные события, инициировать события с передачей данных, а также удалять обработчики и сбрасывать все обработчики.

#### Свойства
- **_events**: Map<EventName, Set<Subscriber>> - Хранит сопоставление событий и их подписчиков.

#### Конструктор
- **constructor()**:
  - Создает экземпляр класса EventEmitter.

#### Методы
1. **on<T extends object>(eventName: EventName, callback: (event: T) => void)**:
   - Устанавливает обработчик для указанного события.
   
2. **off(eventName: EventName, callback: Subscriber)**:
   - Удаляет обработчик для указанного события.
   
3. **emit<T extends object>(eventName: string, data?: T)**:
   - Инициирует событие с передачей данных подписчикам.
   
4. **onAll(callback: (event: EmitterEvent) => void)**:
   - Устанавливает обработчик для всех событий.
   
5. **offAll()**:
   - Удаляет все обработчики событий.
   
6. **trigger<T extends object>(eventName: string, context?: Partial<T>)**:
   - Возвращает функцию-триггер, которая генерирует событие при вызове.



## 3. Абстрактный класс Model<T> 
Служит основой для создания моделей в приложении. Предоставляет базовый функционал для управления данными модели и оповещения об изменениях.

#### Свойства
- **events**: IEvents - Объект, представляющий систему управления событиями, необходимый для оповещения об изменениях в модели.

#### Конструктор
- **constructor(data: Partial<T>, events: IEvents)**:
  - Использует Object.assign для инициализации свойств модели на основе переданных данных.

#### Методы
1. **emitChanges(event: string, payload?: object)**:
   - Оповещает об изменениях в модели, инициируя событие с передачей данных.
   - Позволяет изменить состав данных перед отправкой.

# Модели данных

## 1. Класс AppState 
Расширяет функциональность базового класса Model, предоставляя методы для работы с данными о товарах, заказах и формами.
Данный класс используется для управления состоянием приложения, связанным с выбором товаров, формированием заказа и валидацией данных.

#### Свойства
- **basket**: LotItem[] - Массив товаров в корзине.
- **catalog**: LotItem[] - Массив товаров в каталоге.
- **order**: IOrder - Объект заказа, содержащий информацию о заказе.
- **preview**: string | null - Предпросмотр товара.
- **formErrorsOrder**: FormErrors - Объект ошибок для формы заказа.
- **formErrorsContacts**: FormErrors - Объект ошибок для формы контактов.

#### Методы
1. **clearBasket()**:
   - Очищает корзину и заказ.
   
2. **getTotal()**:
   - Возвращает общую стоимость товаров в корзине.

3. **getBasketItems()**: 
   - Возвращает массив товаров в корзине.

4. **setCatalog(items: ILotItem[])**:
   - Устанавливает каталог товаров, преобразуя данные в объекты LotItem.
   
5. **setPreview(item: LotItem)**:
   - Устанавливает товар для предпросмотра.

6. **addLot(lot: LotItem)**:
   - Добавляет товар в корзину и заказ.

7. **removeLot(id: string)**:
   - Удаляет товар из корзины и заказа.

8. **setOrderField(field: keyof IOrderForm, value: string)**:
   - Устанавливает значение поля заказа и проверяет его на валидность.

9. **setContactsField(field: keyof IOrderForm, value: string)**:
   - Устанавливает значение поля контактов и проверяет его на валидность.

10. **validateContacts()**:
    - Проверяет валидность данных формы контактов и оповещает об изменениях ошибок.

11. **validateOrder()**:
    - Проверяет валидность данных формы заказа и оповещает об изменениях ошибок.

## 2. Класс WebAPI 
Предоставляет методы для взаимодействия с API, связанные с получением информации о товарах и оформлением заказов.

#### Свойства
- **cdn**: string - URL-адрес CDN для загрузки изображений.
- **baseUrl**: string - Базовый URL для API.
- **options**: RequestInit - Настройки запроса по умолчанию.

#### Конструктор
- **constructor(cdn: string, baseUrl: string, options?: RequestInit)**:
  - Создает экземпляр класса WebAPI с указанием URL CDN, базового URL API и дополнительных настроек запроса.

#### Методы
1. **getLotItem(id: string): Promise<ILotItem>**:
   - Возвращает Promise с объектом типа ILotItem, где изображение товара обновляется с использованием URL CDN.

2. **getLotList(): Promise<ILotItem[]>**:
   - Возвращает Promise с массивом объектов типа ILotItem, где изображения товаров обновляются с использованием URL CDN.

3. **orderLots(order: IOrder): Promise<IOrderResult>**:
   - Оформляет заказ на товары.
   - Возвращает Promise с результатом заказа типа IOrderResult.
  
 # Компоненты представления

 ## 1. Класс Page 
 Представляет веб-страницу целиком с функциональностью для управления счетчиком товаров в корзине, каталогом товаров и блокировкой страницы.

 #### Свойства
- **_counter**: HTMLElement - Элемент счетчика товаров в корзине.
- **_catalog**: HTMLElement - Элемент каталога товаров.
- **_wrapper**: HTMLElement - Обертка страницы.
- **_basket**: HTMLElement - Элемент корзины.

#### Конструктор
- **constructor(container: HTMLElement, events: IEvents)**:
  - Создает экземпляр класса Page с указанием контейнера, в котором будет размещаться страница, и объекта событий events.
  - Устанавливает обработчик клика на элемент корзины для открытия списка покупок.

#### Сеттеры
1. **counter**: number - Устанавливает значение счетчика товаров на иконке корзины.
2. **catalog**: HTMLElement[] - Устанавливает элементы в каталоге товаров.
3. **locked**: boolean - Устанавливает/снимает блокировку страницы.

#### Методы
- **setText(element: HTMLElement, text: string)**:
  - Устанавливает текст в элемент.
 
## 2. Класс Card<T> 
Представляет собой компонент для отображения карточек с информацией о товаре или услуге.

#### Свойства
- **_title**: HTMLElement - Элемент заголовка карточки.
- **_image**: HTMLImageElement | undefined - Элемент изображения карточки.
- **_description**: HTMLElement | undefined - Элемент описания карточки.
- **_button**: HTMLButtonElement | undefined - Элемент кнопки карточки.
- **_category**: HTMLElement - Элемент категории карточки.
- **_price**: HTMLElement - Элемент цены карточки.
- **_categoryColor**: Record<string, string> - Объект с соответствиями классов для различных категорий.

#### Конструктор
- **constructor(blockName: string, container: HTMLElement, actions?: ICardActions)**:
  - Создает экземпляр класса Card<T> с указанием имени блока, контейнера, в котором будет размещаться карточка, и действий, которые могут быть привязаны к карточке.
  - Инициализирует элементы заголовка, изображения, кнопки, описания, категории и цены карточки.
  - Устанавливает обработчик клика на кнопку, если он предоставлен.

#### Сеттеры и Геттеры
1. **id**: string - Устанавливает и возвращает уникальный идентификатор карточки.
2. **title**: string - Устанавливает и возвращает заголовок карточки.
3. **image**: string - Устанавливает изображение карточки.
4. **description**: string - Устанавливает описание карточки.
5. **category**: string - Устанавливает категорию карточки и применяет соответствующий класс.
6. **price**: number | null - Устанавливает цену карточки и блокирует кнопку, если цена равна null.

## 3. Класс Modal 
Представляет собой компонент для отображения модальных окон на веб-странице.

#### Свойства
- **_closeButton**: HTMLButtonElement - Элемент кнопки закрытия модального окна.
- **_content**: HTMLElement - Элемент содержимого модального окна.

#### Конструктор
- **constructor(container: HTMLElement, events: IEvents)**:
  - Создает экземпляр класса Modal с указанием контейнера, в котором будет размещаться модальное окно, и событий, которые могут происходить в модальном окне.
  - Инициализирует элементы кнопки закрытия и содержимого модального окна.
  - Устанавливает обработчики событий для закрытия модального окна при клике на кнопку закрытия, вне модального окна и предотвращает закрытие при клике внутри модального окна.

#### Сеттеры и Методы
1. **content**: HTMLElement - Устанавливает содержимое модального окна путем замены текущего содержимого.
2. **open()**: Открывает модальное окно путем добавления класса modal_active к контейнеру и генерирует событие modal:open.
3. **close()**: Закрывает модальное окно путем удаления класса modal_active из контейнера, очищает содержимое модального окна и генерирует событие modal:close.
4. **render(data: IModalData)**: Рендерит модальное окно с данными из объекта data, открывает модальное окно и возвращает контейнер.

## 4. Класс Basket 
Представляет собой компонент для управления корзиной товаров на веб-странице.

#### Свойства
- **_list**: HTMLElement - Элемент списка товаров в корзине.
- **_total**: HTMLElement - Элемент для отображения общей суммы покупки.
- **_button**: HTMLElement - Элемент кнопки оформления заказа.

#### Конструктор
- **constructor(container: HTMLElement, events: EventEmitter)**:
  - Создает экземпляр класса Basket с указанием контейнера, в котором будет размещаться корзина, и событий, которые могут происходить в корзине.
  - Инициализирует элемент списка товаров, общей суммы и кнопки оформления заказа.
  - Устанавливает обработчик события click на кнопку оформления заказа для генерации события 'order:open'.

#### Сеттеры
1. **items(items: HTMLElement[])**:
   - Устанавливает список товаров в корзине путем замены текущего содержимого.
   - Если список товаров не пустой, заменяет текущий список на новый и активирует кнопку оформления заказа.
   - Если список товаров пуст, выводит сообщение "Корзина пуста" и блокирует кнопку оформления заказа.

2. **total(total: number)**:
   - Устанавливает общую сумму покупки для отображения в элементе _total.

## 5. Класс Form<T> 
Представляет форму на веб-странице с возможностью управления ее состоянием, валидацией и отображением ошибок. 

#### Свойства
- **_submit**: HTMLButtonElement - Элемент кнопки submit.
- **_errors**: HTMLElement - Элемент для отображения ошибок.

#### Конструктор
- **constructor(container: HTMLFormElement, events: IEvents)**:
  - Создает экземпляр класса Form<T> с указанием контейнера формы и событий, которые могут происходить в форме.
  - Устанавливает обработчик события input на форме для отслеживания изменений в полях формы и вызова метода onInputChange.
  - Устанавливает обработчик события submit на форме для предотвращения стандартного поведения и генерации события ${this.container.name}:submit.

#### Методы
- **onInputChange(field: keyof T, value: string)**:
  - Генерирует событие ${this.container.name}.${String(field)}:change при изменении значения поля формы.

#### Сеттеры
1. **valid(value: boolean)**:
   - Устанавливает состояние кнопки submit в зависимости от переданного значения. Если значение true, кнопка активна, если false, кнопка заблокирована.

2. **errors(value: string)**:
   - Устанавливает текст ошибок для отображения в элементе _errors.

3. **render(state: Partial<T> & IFormState)**:
  - Извлекает из состояния формы информацию о валидности, ошибках и остальных полях.
  - Вызывает метод super.render({valid, errors}) для рендеринга базовой информации.
  - Копирует остальные поля из состояния в экземпляр класса.
  - Возвращает контейнер формы.

## 6. Класс Order 
Расширяет функциональность базового класса Form<IOrderForm> и добавляет дополнительные методы и свойства для работы с формой заказа. 

#### Свойства
- **_buttons**: HTMLButtonElement[] - Массив кнопок, найденных в контейнере формы.

#### Конструктор
- **constructor(container: HTMLFormElement, events: IEvents)**:
  - Создает экземпляр класса Order с указанием контейнера формы и событий, которые могут происходить в форме.
  - Инициализирует массив кнопок _buttons, найденных в контейнере формы.
  - Устанавливает обработчик события click на каждой кнопке для генерации события 'payment:set' и установки значения свойства payment.

#### Сеттеры
1. **phone(value: string)**:
   - Устанавливает значение поля "phone" в форме.

2. **email(value: string)**:
   - Устанавливает значение поля "email" в форме.

3. **payment(name: string)**:
   - Устанавливает активное состояние кнопки оплаты на основе переданного имени.

4. **address(value: string)**:
   - Устанавливает значение поля "address" в форме.

## 7. Класс Success 
Представляет компонент успешного завершения заказа, который отображает общую сумму заказа. Он также предоставляет возможность закрыть окно заказа. 

#### Свойства
- **_close**: HTMLElement - Элемент для закрытия окна заказа.
- **_total**: HTMLElement - Элемент, отображающий общую сумму заказа.

#### Конструктор
- **constructor(container: HTMLElement, actions: ISuccessActions)**:
  - Создает экземпляр класса Success с указанием контейнера элемента и действий, которые могут происходить в компоненте.
  - Инициализирует свойства _close и _total, находя соответствующие элементы в контейнере.
  - Устанавливает обработчик события click на элементе _close для выполнения действия, указанного в actions.onClick.

#### Сеттер
- **total(value: string)**:
  - Устанавливает содержимое элемента _total, отображая общую сумму заказа.

## Файл **src/index.ts.** выполняет роль Презентера.
